# 设计模式

策略模式Strategy（对象行为型）

我们去旅行。策略模式的做法：有几种方案供你选择旅行，选择火车好呢还是骑自行车，完全有客户自行决定去构建旅行方案（比如你自己需要去买火车票，或者机票）。而工厂模式是你决定哪种旅行方案后，不用关注这旅行方案怎么给你创建，也就是说你告诉我方案的名称就可以了，然后由工厂代替你去构建具体方案（工厂代替你去买火车票）。



**定**义一系列的算法,把每一个算法封装起来, 并且使它们可相互替换。本模式使得算法可独立于使用它的客户而变化。



本人理解：

存在多个继承同一个基类的实现类，在客户端通过switch选择某一个子类创建并调用基类定义的方法以此实现客户想要进行的行为。



简单点说就是多个类都实现了父类的方法，只是执行逻辑不同而已，所以在不同场景下可以相互替换，交由客户来选择。



优点：

1. 可以自由切换算法
2. 避免使用多重条件判断（使用if（）else if（）之类来选择算法这样的）
3. 扩展性好（不影响其他代码，只需增加就行）



缺点：

1. 策略类会增多
2. 所有策略类都需要对外暴露





## 封装、抽象、继承、多态分别可以解决哪些编程问题？



### 封装（Encapsulation）

封装特性。封装也叫作信息隐藏或者数据访问保护。类通过暴露有限的访问 接口，授权外部仅能通过类提供的方式（或者叫函数）来访问内部信息或者数据

对于封装这个特性，我们需要编程语言本身提供一定的语法机制来支持。这个语法机制就是 访问权限控制



**封装特性的定义讲完了，我们再来看一下，封装的意义是什么？它能解决什么编程问题？**

如果我们对类中属性的访问不做限制，那任何代码都可以访问、修改类中的属性，虽然这样看起来更加灵活，但从另一方面来说，过度灵活也意味着不可控，属性可以随意被以各种奇葩的方式修改，而且修改逻辑可能散落在代码中的各个角落，势必**影响代码的可读性、可维护性**。

除此之外，**类仅仅通过有限的方法暴露必要的操作，也能提高类的易用性**。如果我们把类属性都暴露给类的调用者，调用者想要正确地操作这些属性，就势必要对业务细节有足够的了 解。而这对于调用者来说也是一种负担。相反，如果我们将属性封装起来，暴露少许的几个必要的方法给调用者使用，调用者就不需要了解太多背后的业务细节，用错的概率就减少很多



封装主要讲的是如何隐藏信息、保护数据，而抽象讲的是如何隐藏方法的具体实现，让调用者只需要关心方法提供了哪些功能，并不需要知道这些功能是如何实现的。



### 抽象（Abstraction）

在面向对象编程中，我们常借助编程语言提供的接口类（比如 Java 中的 interface 关键字 语法）或者抽象类（比如 Java 中的 abstract 关键字语法）这两种语法机制，来实现抽象这一特性。



我们利用 Java 中的 interface 接口语法来实现抽象特性。调用者在 使用图片存储功能的时候，只需要了解 IPictureStorage 这个接口类暴露了哪些方法就可以 了，不需要去查看 PictureStorage 类里的具体实现逻辑。

实际上，抽象这个特性是非常容易实现的，并不需要非得依靠接口类或者抽象类这些特殊语 法机制来支持。换句话说，并不是说一定要为实现类（PictureStorage）抽象出接口类 （IPictureStorage），才叫作抽象

类的方法是通过编程语言中的“函数”这一语法机制来实现的。 通过函数包裹具体的实现逻辑，这本身就是一种抽象。调用者在使用函数的时候，并不需要去研究函数内部的实现逻辑，只需要通过函数的命名、注释或者文档，了解其提供了什么功能，就可以直接使用了。



抽象有时候会被排除在面向对象的四大特性之外， 当时我卖了一个关子，现在我就来解释一下为什么。

抽象这个概念是一个非常通用的设计思想，并不单单用在面向对象编程中，也可以用来指导 架构设计等。而且这个特性也并不需要编程语言提供特殊的语法机制来支持，只需要提 供“函数”这一非常基础的语法机制，就可以实现抽象特性、所以，它没有很强的“特异 性”，有时候并不被看作面向对象编程的特性之一。



**抽象特性的定义讲完了，我们再来看一下，抽象的意义是什么？它能解决什么编程问题？**

实际上，如果上升一个思考层面的话，抽象及其前面讲到的封装都是人类**处理复杂性的有效手段**。在面对复杂系统的时候，人脑能承受的信息复杂程度是有限的，所以我们必须忽略掉 一些非关键性的实现细节。而抽象作为一种只关注功能点不关注实现的设计思路，正好帮我 们的大脑过滤掉许多非必要的信息。

除此之外，抽象作为一个非常宽泛的**设计思想**，在代码设计中，起到非常重要的指导作用。 很多设计原则都体现了抽象这种设计思想，比如基于接口而非实现编程、开闭原则（对扩展 开放、对修改关闭）、代码解耦（降低代码的耦合性）等

换一个角度来考虑，我们在定义（或者叫命名）类的方法的时候，也要有抽象思维，不要在 方法定义中，暴露太多的实现细节，以保证在某个时间点需要改变方法的实现逻辑的时候， 不用去修改其定义。





### 继承（Inheritance）

继承是用来表示类之间的 is-a 关系，比如猫是一种哺乳动物。从继承关系上来讲，继承可以分为两种模式，单继承 和多继承。



**继承特性的定义讲完了，我们再来看，继承存在的意义是什么？它能解决什么编程问题？**

继承最大的一个好处就是代码复用。假如两个类有一些相同的属性和方法，我们就可以将这 些相同的部分，抽取到父类中，让两个子类继承父类。这样，两个子类就可以重用父类中的 代码，避免代码重复写多遍。不过，这一点也并不是继承所独有的，我们也可以通过其他方 式来解决这个代码复用的问题，比如利用组合关系而不是继承关系。

继承的概念很好理解，也很容易使用。不过，过度使用继承，继承层次过深过复杂，就会导 致代码可读性、可维护性变差。为了了解一个类的功能，我们不仅需要查看这个类的代码， 还需要按照继承关系一层一层地往上查看“父类、父类的父类……”的代码。还有，子类和 父类高度耦合，修改父类的代码，会直接影响到子类。





### 多态（Polymorphism）

多态这种特性也需要编程语言提供特殊的语法机制来实现:

* 第一个语法机制是编程语言要支持父类对象可以引用子类对象
* 第二个语法机制是编程语言要支持继承
* 第三个语法机制是编程语言要支持子类可以重写（override）父类中的方法



对于多态特性的实现方式，除了利用“继承加方法重写”这种实现方式之外，我们还有其他 两种比较常见的的实现方式，一个是利用接口类语法，另一个是利用 duck-typing 语法。 不过，并不是每种编程语言都支持接口类或者 duck-typing 这两种语法机制，比如 C++ 就不支持接口类语法，而 duck-typing 只有一些动态语言才支持，比如 Python、 JavaScript 等。

* 何利用接口类来实现多态特性
* duck-typing 实现多态的方式非常灵活。Logger 和 DB 两个类 没有任何关系，既不是继承关系，也不是接口和实现的关系，但是只要它们都有定义了 record() 方法，就可以被传递到 test() 方法中，在实际运行的时候，执行对应的 record() 方法。也就是说，只要两个类具有相同的方法，就可以实现多态，并不要求两个类之间有任何关 系，这就是所谓的 duck-typing，是一些动态语言所特有的语法机制。而像 Java 这样的静 态语言，通过继承实现多态特性，必须要求两个类之间有继承关系，通过接口实现多态特 性，类必须实现对应的接口。



**多态特性讲完了，我们再来看，多态特性存在的意义是什么？它能解决什么编程问题？**

1. 多态特性能提高代码的可扩展性和复用性

   利用多态的特性，**仅用一个 print() 函数就可以实现遍历打印不同类型 （Array、LinkedList）集合的数据**。当再增加一种要遍历打印的类型的时候，比如 HashMap，我们只需让 HashMap 实现 Iterator 接口，重新实现自己的 hasNext()、next() 等方法就可以了，**完全不需要改动print() 函数的代码**。所以说，多态提高了代码的 可扩展性。如果我们不使用多态特性，我们就无法将不同的集合类型（Array、LinkedList）传递给相 同的函数（print(Iterator iterator) 函数）。我们需要针对每种要遍历打印的集合，分别实 现不同的 print() 函数，比如针对 Array，我们要实现 print(Array array) 函数，针对 LinkedList，我们要实现 print(LinkedList linkedList) 函数。而利用多态特性，我们**只需要 实现一个 print() 函数的打印逻辑，就能应对各种集合数据的打印操作，这显然提高了代码的复用性。**

2. 除此之外，多态也是很多设计模式、设计原则、编程技巧的代码实现基础，比如策略模式、 基于接口而非实现编程、依赖倒置原则、里式替换原则、利用多态去掉冗长的 if-else 语句



### 总结与问答

```markdown
1. 关于封装特性
封装也叫作信息隐藏或者数据访问保护。类通过暴露有限的访问接口，授权外部仅能通过类提供的方式来访问内部信息或者数据。它需要编程语言提供权限访问控制语法来支持，例如Java 中的 private、protected、public 关键字。封装特性存在的意义，一方面是保护数据不被随意修改，提高代码的可维护性；另一方面是仅暴露有限的必要接口，提高类的易用性。

2. 关于抽象特性
封装主要讲如何隐藏信息、保护数据，那抽象就是讲如何隐藏方法的具体实现，让使用者只需要关心方法提供了哪些功能，不需要知道这些功能是如何实现的。抽象可以通过接口类或者抽象类来实现，但也并不需要特殊的语法机制来支持。抽象存在的意义，一方面是提高代码的可扩展性、维护性，修改实现不需要改变定义，减少代码的改动范围；另一方面，它也是处理复杂系统的有效手段，能有效地过滤掉不必要关注的信息。

3. 关于继承特性
继承是用来表示类之间的 is-a 关系，分为两种模式：单继承和多继承。单继承表示一个子类只继承一个父类，多继承表示一个子类可以继承多个父类。为了实现继承这个特性，编程语言需要提供特殊的语法机制来支持。继承主要是用来解决代码复用的问题。

4. 关于多态特性
多态是指子类可以替换父类，在实际的代码运行过程中，调用子类的方法实现。多态这种特性也需要编程语言提供特殊的语法机制来实现，比如继承、接口类、duck-typing。多态可以提高代码的扩展性和复用性，是很多设计模式、设计原则、编程技巧的代码实现基础。
```



```markdown
你熟悉的编程语言是否支持多重继承？如果不支持，请说一下为什么不支持。如果支持，请说一下它是如何避免多重继承的副作用的

首先java类支持多继承的话，两个父类有同名方法，在子类中调用的时候就不知道调用哪个了，出现决议(钻石问题或菱形问题)问题而接口支持多继承因为接口定义的方法不能有方法体，所以不会出现决议问题。
```







## 面向对象相比面向过程有哪些优势？面向过程真的过时 了吗？

<font color='cornflowerblue'>什么是面向过程编程与面向过程编程语言？</font>

面向对象编程是一种编程范式或编程风格。它以类或对象作为组织代码的基本单元，并 将封装、抽象、继承、多态四个特性，作为代码设计和实现的基石 。 

面向对象编程语言是支持类或对象的语法机制，并有现成的语法机制，能方便地实现面 向对象编程四大特性（封装、抽象、继承、多态）的编程语言。

面向过程编程也是一种编程范式或编程风格。它以过程（可以为理解方法、函数、操 作）作为组织代码的基本单元，以数据（可以理解为成员变量、属性）与方法相分离为 最主要的特点。面向过程风格是一种流程化的编程风格，通过拼接一组顺序执行的方法 来操作数据完成一项功能。

面向过程编程语言首先是一种编程语言。它最大的特点是不支持类和对象两个语法概 念，不支持丰富的面向对象编程特性（比如继承、多态、封装），仅支持面向过程编 程。



**面向过程和面向对象最基本的区别**就是，代码的组织方式 不同。面向过程风格的代码被组织成了一组方法集合及其数据结构（struct User），方法 和数据结构的定义是分开的。面向对象风格的代码被组织成一组类，方法和数据结构被绑定 一起，定义在类中。



**面向对象编程相比面向过程编程有哪些优势？**

1. OOP 更加能够应对大规模复杂程序的开发

   对于简单程序的开发来说，不管是用面向过程编程风格，还是用面向对象编程风格，差别确 实不会很大，甚至有的时候，面向过程的编程风格反倒更有优势。因为需求足够简单，整个 程序的处理流程只有一条主线，很容易被划分成顺序执行的几个步骤，然后逐句翻译成代 码，这就非常适合采用面向过程这种面条式的编程风格来实现。

   但对于大规模复杂程序的开发来说，整个程序的处理流程错综复杂，并非只有一条主线。如 果把整个程序的处理流程画出来的话，会是一个网状结构。如果我们再用面向过程编程这种 流程化、线性的思维方式，去翻译这个网状结构，去思考如何把程序拆解为一组顺序执行的 方法，就会比较吃力。这个时候，面向对象的编程风格的优势就比较明显了。

   面向对象编程是以类为思考对象。在进行面向对象编程的时候，我们并不是一上来就去思 考，如何将复杂的流程拆解为一个一个方法，而是采用曲线救国的策略，先去思考如何给业 务建模，如何将需求翻译为类，如何给类之间建立交互关系，而完成这些工作完全不需要考 虑错综复杂的处理流程。当我们有了类的设计之后，然后再像搭积木一样，按照处理流程， 将类组装起来形成整个程序。这种开发模式、思考问题的方式，能让我们在应对复杂程序开 发的时候，思路更加清晰。

   除此之外，面向对象编程还提供了一种更加清晰的、更加模块化的代码组织方式。比如，我 们开发一个电商交易系统，业务逻辑复杂，代码量很大，可能要定义数百个函数、数百个数 据结构，那如何分门别类地组织这些函数和数据结构，才能不至于看起来比较凌乱呢？类就 是一种非常好的组织这些函数和数据结构的方式，是一种将代码模块化的有效手段。

   像 C 语言这种面向过程的编程语言，我们也可以按照功能的不同，把函数和 数据结构放到不同的文件里，以达到给函数和数据结构分类的目的，照样可以实现代码的模 块化。你说得没错。只不过面向对象编程本身提供了类的概念，强制你做这件事情，而面向 过程编程并不强求。这也算是面向对象编程相对于面向过程编程的一个微创新吧

   实际上，利用面向过程的编程语言照样可以写出面向对象风格的代码，只不过可能会比用面 向对象编程语言来写面向对象风格的代码，付出的代价要高一些。而且，面向过程编程和面 向对象编程并非完全对立的。很多软件开发中，尽管利用的是面向过程的编程语言，也都有 借鉴面向对象编程的一些优点。

2. OOP 风格的代码更易复用、易扩展、易维护

   面向过程编程是一种非常简单的编程风格，并没有像面向对象编程那样提供丰富的特性。而 面向对象编程提供的封装、抽象、继承、多态这些特性，能极大地满足复杂的编程需求，能 方便我们写出更易复用、易扩展、易维护的代码。

   首先，我们先来看下封装特性。封装特性是面向对象编程相比于面向过程编程的一个最基本 的区别，因为它基于的是面向对象编程中最基本的类的概念。面向对象编程通过类这种组织 代码的方式，将数据和方法绑定在一起，通过访问权限控制，只允许外部调用者通过类暴露 的有限方法访问数据，而不会像面向过程编程那样，数据可以被任意方法随意修改。因此， 面向对象编程提供的封装特性更有利于提高代码的易维护性。

   其次，我们再来看下抽象特性。我们知道，函数本身就是一种抽象，它隐藏了具体的实现。 我们在使用函数的时候，只需要了解函数具有什么功能，而不需要了解它是怎么实现的。从 这一点上，不管面向过程编程还是是面向对象编程，都支持抽象特性。不过，面向对象编程 还提供了其他抽象特性的实现方式。这些实现方式是面向过程编程所不具备的，比如基于接 口实现的抽象。基于接口的抽象，可以让我们在不改变原有实现的情况下，轻松替换新的实 现逻辑，提高了代码的可扩展性。

   再次，我们来看下继承特性。继承特性是面向对象编程相比于面向过程编程所特有的两个特 性之一（另一个是多态）。如果两个类有一些相同的属性和方法，我们就可以将这些相同的 代码，抽取到父类中，让两个子类继承父类。这样两个子类也就可以重用父类中的代码，避 免了代码重复写多遍，提高了代码的复用性。

   最后，我们来看下多态特性。基于这个特性，我们在需要修改一个功能实现的时候，可以通 过实现一个新的子类的方式，在子类中重写原来的功能逻辑，用子类替换父类。在实际的代 码运行过程中，调用子类新的功能逻辑，而不是在原有代码上做修改。这就遵从了“对修改 关闭、对扩展开放”的设计原则，提高代码的扩展性。除此之外，利用多态特性，不同的类 对象可以传递给相同的方法，执行不同的代码逻辑，提高了代码的复用性。

3. OOP 语言更加人性化、更加高级、更加智能



### 总结与问答

1. 什么是面向过程编程？什么是面向过程编程语言？

   实际上，面向过程编程和面向过程编程语言并没有严格的官方定义。理解这两个概念最好的 方式是跟面向对象编程和面向对象编程语言进行对比。相较于面向对象编程以类为组织代码 的基本单元，面向过程编程则是以过程（或方法）作为组织代码的基本单元。它最主要的特 点就是数据和方法相分离。相较于面向对象编程语言，面向过程编程语言最大的特点就是不 支持丰富的面向对象编程特性，比如继承、多态、封装。

2. 面向对象编程相比面向过程编程有哪些优势？

   面向对象编程相比起面向过程编程的优势主要有三个。

   对于大规模复杂程序的开发，程序的处理流程并非单一的一条主线，而是错综复杂的网 状结构。

   面向对象编程比起面向过程编程，更能应对这种复杂类型的程序开发。 面向对象编程相比面向过程编程，具有更加丰富的特性（封装、抽象、继承、多态）。 利用这些特性编写出来的代码，更加易扩展、易复用、易维护。 

   从编程语言跟机器打交道的方式的演进规律中，我们可以总结出：面向对象编程语言比 起面向过程编程语言，更加人性化、更加高级、更加智能。





在文章中我讲到，面向对象编程比面向过程编程，更加容易应对大规模复杂程序的开发。但 像 Unix、Linux 这些复杂的系统，也都是基于 C 语言这种面向过程的编程语言开发的，你 怎么看待这个现象？这跟我之前的讲解相矛盾吗？

```markdown
操作系统是业务无关的，它更接近于底层计算机，因此更适合用面向过程的语言编写。而
接近业务的也就是接近人的软件，则更适合用面向对象的语言编写。




关于封装，有两种理解，一种是狭义的面向对象特性：封装是一种
信息隐藏，需要把数据和方法放到一起，而c语言实现的代码，数据和方法是分离的。封装的另一
种广义的理解，可以包含你指的封装函数。抽象实际上我们前面章节中也讲到过，比较没有特异
性，有的时候不看做面向对象的特性。
```

