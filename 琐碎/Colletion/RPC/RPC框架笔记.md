服务注册：在服务提供方启动的时候，将对外暴露的接口注册到注册中心之中，注册中 心将这个服务节点的 IP 和接口保存下来。

服务订阅：在服务调用方启动的时候，去注册中心查找并订阅服务提供方的 IP，然后缓 存到本地，并用于后续的远程调用。

为什么不使用 DNS？
既然服务发现这么“厉害”，那是不是很难实现啊？其实类似机制一直在我们身边，我们回 想下服务发现的本质，就是完成了接口跟服务提供者 IP 的映射。那我们能不能把服务提供 者 IP 统一换成一个域名啊，利用已经成熟的 DNS 机制来实现？

如果我们用 DNS 来实现服务发现，所有的服务提供者节点都配置在了同一个域名下，调用 方的确可以通过 DNS 拿到随机的一个服务提供者的 IP，并与之建立长连接，这看上去并没 有太大问题，但在我们业界为什么很少用到这种方案呢？不知道你想过这个问题没有，如果 没有，现在可以停下来想想这样两个问题：

1. 如果这个 IP 端口下线了，服务调用者能否及时摘除服务节点呢？ 
2. 如果在之前已经上线了一部分服务节点，这时我突然对这个服务进行扩容，那么新上线 的服务节点能否及时接收到流量呢？

这时你可能会想，我是不是可以加一个负载均衡设备呢？将域名绑定到这台负载均衡设备 上，通过 DNS 拿到负载均衡的 IP。这样服务调用的时候，服务调用方就可以直接跟 VIP 建立连接，然后由 VIP 机器完成 TCP 转发


这个方案确实能解决 DNS 遇到的一些问题，但在 RPC 场景里面也并不是很合适，原因有 以下几点：

搭建负载均衡设备或 TCP/IP 四层代理，需求额外成本； 
请求流量都经过负载均衡设备，多经过一次网络传输，会额外浪费些性能； 
负载均衡添加节点和摘除节点，一般都要手动添加，当大批量扩容和下线时，会有大量 的人工操作和生效延迟； 
我们在服务治理的时候，需要更灵活的负载均衡策略，目前的负载均衡设备的算法还满 足不了灵活的需求