# 计算机网络



TCP三次握手 
TCP 四次挥手 
为什么建立三次、断开是四次 
四次挥手套接字的状态转移 
输入url的流程 
http的request、response的具体格式





## HTTP 和 HTTPS 有哪些区别





## HTTP

### HTTP协议是什么?

http协议是一个计算机世界中专门在两点之间传输(所以不能用于广播,寻址或路由)文字,图片,视频,音频等超文本数据的约定和规范

严格的讲:协议包括 **语法,语义,同步规则,错误处理**



http并不孤立,在互联网世界里，HTTP 通常跑在 TCP/IP 协议栈之上，依靠 IP 协议实现寻址和路由、TCP 协议实现可靠数据传输、DNS 协议实现域名查找、SSL/TLS 协议实现安全通信。此外，还 有一些协议依赖于 HTTP，例如 WebSocket、HTTPDNS 等。这些协议相互交织，构成了 一个协议网，而 HTTP 则处于中心地位。



HTTP又是什么?

与 HTTP 协议相关的所有应用层技术的总和



服务器能当客户端,但浏览器只能是客户端





### 互联网

我们通常所说的“上 网”实际上访问的只是互联网的一个子集“万维网”（World Wide Web），它基于 HTTP 协议，传输 HTML 等超文本资源，能力也就被限制在 HTTP 协议之内。

互联网上还有许多万维网之外的资源，例如常用的电子邮件、BT 和 Magnet 点对点下载、 FTP 文件下载、SSH 安全登录、各种即时通信服务等等，它们需要用各自的专有协议来访 问。



### Web服务器

刚才说的浏览器是 HTTP 里的请求方，那么在协议另一端的应答方（响应方）又是什么 呢？ 这个你一定也很熟悉，答案就是服务器，Web Server。

Web 服务器是一个很大也很重要的概念，它是 HTTP 协议里响应请求的主体，通常也把控 着绝大多数的网络资源，在网络世界里处于强势地位。

当我们谈到“Web 服务器”时有两个层面的含义：硬件和软件。



### CDN

CDN，全称是“Content Delivery Network”，翻译过来就是“内容分发网络”。它应用 了 HTTP 协议里的缓存和代理技术，代替源站响应客户端的请求。

CDN 有什么好处呢？ 简单来说，它可以缓存源站的数据，让浏览器的请求不用“千里迢迢”地到达源站服务器， 直接在“半路”就可以获取响应。如果 CDN 的调度算法很优秀，更可以找到离用户最近的 节点，大幅度缩短响应时间。

CDN 位于浏览器和服务器之间，主要起到缓存加速的作用；

CDN，实际上就是一种代理，它代替源站服务器响应客户端的请求，通常扮 演着透明代理和反向代理的角色。

### IP协议

IP 协议是“Internet Protocol”的缩写，主要目的是解决寻址和路由问题，以及如何在两 点间传送数据包。IP 协议使用“IP 地址”的概念来定位互联网上的每一台计算机。



### TCP协议

TCP 协议是“Transmission Control Protocol”的缩写，意思是“传输控制协议”，它位 于 IP 协议之上，基于 IP 协议提供可靠的、字节流形式的通信，是 HTTP 协议得以实现的 基础。

“可靠”是指保证数据不丢失，“字节流”是指保证数据完整，所以在 TCP 协议的两端可 以如同操作文件一样访问传输的数据，就像是读写在一个密闭的管道里“流动”的字节。





### DNS

在 DNS 中，“域名”（Domain Name）又称为“主机名”（Host），为了更好地标记不 同国家或组织的主机，让名字更好记，所以被设计成了一个有层次的结构。 域名用“.”分隔成多个单词，级别从左到右逐级升高，最右边的被称为“顶级域名”。

HTTP 协议中并没有明确要求必须使用 DNS，但实际上为了方便访问互联网上的 Web 服 务器，通常都会使用 DNS 来定位或标记主机名，间接地把 DNS 与 HTTP 绑在了一起。



#### 有了 TCP/IP 和 DNS，是不是我们就可以任意访问网络上的资源了呢?

还不行，DNS 和 IP 地址只是标记了互联网上的主机，但主机上有那么多文本、图片、页 面，到底要找哪一个呢？就像小明管理了一大堆文档，你怎么告诉他是哪个呢？ 所以就出现了 URI（Uniform Resource Identifier），中文名称是 统一资源标识符，使用 它就能够唯一地标记互联网上资源。 URI 另一个更常用的表现形式是 URL（Uniform Resource Locator）， 统一资源定位 符，也就是我们俗称的“网址”，它实际上是 URI 的一个子集，不过因为这两者几乎是相 同的，差异不大，所以通常不会做严格的区分。



URI 主要有三个基本的部分构成：

1. 协议名：即访问该资源应当使用的协议，在这里是“http”； 
2.  主机名：即互联网上主机的标记，可以是域名或 IP 地址，在这里是“nginx.org”； 
3. 路径：即资源在主机上的位置，使用“/”分隔多级目录，在这里 是“/en/download.html”。



URI 是用来标记互联网上资源的一个名字，由“协议名 + 主机名 + 路径”构成，俗称 URL；



### 代理

代理（Proxy）是 HTTP 协议中请求方和应答方中间的一个环节，作为“中转站”，既可以 转发客户端的请求，也可以转发服务器的应答。



代理有很多的种类，常见的有： 

1. 匿名代理：完全“隐匿”了被代理的机器，外界看到的只是代理服务器； 
2.  透明代理：顾名思义，它在传输过程中是“透明开放”的，外界既知道代理，也知道客 户端
3.  正向代理：靠近客户端，代表客户端向服务器发送请求； 
4.  反向代理：靠近服务器端，代表服务器响应客户端的请求；



1. 负载均衡：把访问请求均匀分散到多台机器，实现访问集群化； 
2. 内容缓存：暂存上下行的数据，减轻后端的压力； 
3. 安全防护：隐匿 IP, 使用 WAF 等工具抵御网络攻击，保护被代理的机器； 
4. 数据处理：提供压缩、加密等额外的功能。



## 传输层

TCP和UDP,两个协议的另一个重要区别在于数据的形式。TCP 的数据是连 续的“字节流”，有先后顺序，而 UDP 则是分散的小数据包，是顺序发，乱序收。

 TCP/IP 实际应用时的会话管理、编码转换、压缩 等和具体应用经常联系的很紧密，很难分开。例如，HTTP 协议就同时包含了连接管理和数 据格式定义。



所谓的“四层负载均衡”就是指工作在传输层上，基于 TCP/IP 协议的特性，例如 IP 地 址、端口号等实现对后端服务器的负载均衡。 

所谓的“七层负载均衡”就是指工作在应用层上，看到的是 HTTP 协议，解析 HTTP 报文 里的 URI、主机名、资源类型等数据，再用适当的策略转发给后端服务器。





### 二层转发

设备工作在链路层，帧在经过交换机设备时，检查帧的头部信息，拿到目标 mac地址，进行本地转发和广播

### 三层路由

设备工作在ip层，报文经过有路由功能的设备时，设备分析报文中的头部信 息，拿到ip地址，根据网段范围，进行本地转发或选择下一个网关



## 域名的解析

就像 IP 地址必须转换成 MAC 地址才能访问主机一样，域名也必须要转换成 IP 地址，这个 过程就是“域名解析”。



DNS 的核心系统是一个三层的树状、分布式服务，基本对应域名的结构： 

1. 根域名服务器（Root DNS Server）：管理顶级域名服务器，返 回“com”“net”“cn”等顶级域名服务器的 IP 地址； 
2. 顶级域名服务器（Top-level DNS Server）：管理各自域名下的权威域名服务器，比如 com 顶级域名服务器可以返回 apple.com 域名服务器的 IP 地址； 
3. 权威域名服务器（Authoritative DNS Server）：管理自己域名下主机的 IP 地址，比如 apple.com 权威域名服务器可以返回 www.apple.com 的 IP 地址。



例如，你要访问“www.apple.com”，就要进行下面的三次查询： 

1. 访问根域名服务器，它会告诉你“com”顶级域名服务器的地址；
2. 访问“com”顶级域名服务器，它再告诉你“apple.com”域名服务器的地址； 
3. 最后访问“apple.com”域名服务器，就得到了“www.apple.com”的地址。





虽然核心的 DNS 系统遍布全球，服务能力很强也很稳定，但如果全世界的网民都往这个系 统里挤，即使不挤瘫痪了，访问速度也会很慢。 所以在核心 DNS 系统之外，还有两种手段用来减轻域名解析的压力，并且能够更快地获取 结果，基本思路就是“缓存”。 首先，许多大公司、网络运行商都会建立自己的 DNS 服务器，作为用户 DNS 查询的代 理，**代替用户访问核心 DNS 系统**。这些“野生”服务器被称为“非权威域名服务器”，可 以缓存之前的查询结果，如果已经有了记录，就无需再向根服务器发起查询，直接返回对应 的 IP 地址。



其次，操作系统里也会对 DNS 解析结果做缓存，如果你之前访问 过“www.apple.com”，那么下一次在浏览器里再输入这个网址的时候就不会再跑到 DNS 那里去问了，直接在操作系统里就可以拿到 IP 地址。





操作系统里还有一个特殊的“主机映射”文件，通常是一个可编辑的文本，在 Linux 里是“/etc/hosts”，在 Window是“C:\WINDOWS\system32\drivers\etc\hosts”，如果操作系统在缓存里找不到 DNS 记录，就会找这个文件。



 **浏览器缓存->操作系统缓存->hosts->dns**





##  键入网址再按下回车，后面究竟发生了什么？

1. 浏览器从地址栏的输入中获得服务器的 IP 地址和端口号；
2. 浏览器用 TCP 的三次握手与服务器建立连接； 
3. 浏览器向服务器发送拼好的报文；
4. 服务器收到报文后处理请求，同样拼好报文再发给浏览器； 
5. 浏览器解析报文，渲染输出页面。



HTTP 协议是运行在 TCP/IP 基础上的，依靠 TCP/IP 协议来实现数据的可靠传输。所以浏览器要用 HTTP 协议收发数据，首先要做的就 是建立 TCP 连接。

服务器使用 的端口是 80，经过 SYN、SYN/ACK、ACK 的三个包之后，浏览器与服务器的 TCP 连接就 建立起来了。
